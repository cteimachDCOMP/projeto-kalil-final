<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogos Olímpicos de Londres 2012</title>
    <link rel="stylesheet" href="./style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>

    <div>
    <!-- <script type="module" src="./backend.js"></script> -->
    <h1 id="titulo">Jogos Olímpicos de Londres 2012</h1>
    <p1>A Olimpiada de 2012 foi a terceira vez em que os jogos foram sediados em Londres. Com 204 nacoes presentes e 36 modalidades oferecidas, foi a primeira vez na historia das Olimpiadas em que um atleta biamputado, Oscar Pistorius (Africa do Sul), competiu. Os mascotes da vez foram duas gotas de aco chamadas de Wenlock e Mandeville, representando a cidade industrial de Bolton! Esse 'conceito' industrial tambem foi mencionado na cerimonia de abertura, onde foi apresentada uma historia sobre o avanco da revolucao industrial na Inglaterra. </p1>
    </div>


    <div class="boxed">
        <h2>Qual o atleta mais novo a ganhar uma medalha?</h2>
        <button id='loadBotaoMaisNovoAtleta'>Executar</button></div><br>
        <div id="maisNovoMedalhistaData"></div>
    <!-- <div><span id="output1"></span></div><br><br> -->
    
    <div class="boxed">
        <h2>Quais esportes em que o determinado país ganhou medalhas?</h2>
        <span class="label-wrapper"><form><label for="input1">Digite aqui o país que deseja pesquisar (em Inglês): </label><input id="input1" type="text"></form></span>
        <button id="loadBotaoEsportesPaisMedalha">Executar</button></div><br>
    <div id="esportesPaisMedalhaData"></div>

    <div class="boxed">
        <h2>Quantos medalhistas Brasil possui em determinado esporte?</h2>
        <span class="label-wrapper"><form><label for="input2">Digite aqui o esporte que deseja pesquisar (em Inglês): </label><input id="input2" type="text"></form></span>
        <button id="loadBotaoBrasilEsporteMedalhistas">Executar</button></div><br>
    <div id="brasilEsporteMedalhistasData"></div>

    <div class="boxed">
        <h2>Informações sobre um determinado atleta.</h2>
        <span class="label-wrapper"><form><label for="input3">Digite aqui o nome do atleta desejado: </label><input id="input3" type="text"></form></span>
        <button id="loadBotaoInfoSobreAtleta">Executar</button></div><br>
    <div id="infoSobreAtletaData"></div>

    <div class="boxed">
        <h2>Ranking dos países. (TOP 10)</h2>
        <button id="loadBotaoRankingTop10">Executar</button></div><br>
    <div id="rankingTop10Data"></div>

    <div class="boxed">
        <h2>Qual foi o atleta que mais recebeu medalhas? </h2>
        <button id="loadBotaoAtletaMaisMedalhas">Executar</button></div><br>
    <div id="atletaMaisMedalhasData"></div>


    <script>
        //document.getElementById('loadCsvButton').addEventListener('click', loadCSVData);
        document.getElementById('loadBotaoMaisNovoAtleta').addEventListener('click', botaoMaisNovoAtleta);
        document.getElementById('loadBotaoEsportesPaisMedalha').addEventListener('click', botaoEsportesPaisMedalha);
        document.getElementById('loadBotaoBrasilEsporteMedalhistas').addEventListener('click', botaoBrasilEsporteMedalhistas);
        document.getElementById('loadBotaoInfoSobreAtleta').addEventListener('click', botaoInfoSobreAtleta);
        //document.getElementById('loadBotaoRankingTop10').addEventListener('click', botaoRankingTop10);
        document.getElementById('loadBotaoAtletaMaisMedalhas').addEventListener('click', botaoAtletaMaisMedalhas);
    

        async function botaoMaisNovoAtleta() {
          try {
            const response = await fetch('/csvdata');
            if (!response.ok) {
              throw new Error('Failed to fetch CSV data');
            }
            const data = await response.json();


            const filterNestedDictionary = (obj, condicao) => {
                return Object.fromEntries(
                    Object.entries(obj).filter(([key, nestedObj]) => condicao(key, nestedObj))
                );
            };

            const mapNestedDictionary = (obj, func) => {
                return Object.fromEntries(
                    Object.entries(obj).map(([key, nestedObj]) => [key, func(key, nestedObj)]) 
                    
                );

            };

            const reduceNestedDictionary = (obj, func, valorInicial) => {
                return Object.fromEntries(
                    Object.entries(obj).reduce(([key, nestedObj]) => [key, func(nestedObj)], valorInicial)
                );
                    
            };


            const findNestedDictionary = (obj, condicao) => {
                return Object.fromEntries(
                    Object.entries(obj).find(([key, nestedObj]) => [key, condicao(key, nestedObj)])
                );
            }; 


            // Filtra o registro para armazenar apenas os atletas que participaram da olimpíada de Londres 2012        
            const soLondres = (data) => filterNestedDictionary(data, (key, nestedObj) => nestedObj.Year == '2012');
            // Filtra o registro, apenas com os atletas da olimpíada de Londres 2012, que ganharam medalha        
            const soMedalhistas = (soLondres) => filterNestedDictionary(soLondres(data), (key, nestedObj) => nestedObj.Medal != 'NA')
        
            //QUESTAO1
            const maisNovoMedalhista = (soMedalhistas) => { // retorna o atleta do registro com a menor idade que possui no mínimo 1 medalha.
                const csvDiv = document.getElementById('maisNovoMedalhistaData');
                csvDiv.innerHTML = '';

                    
                    const menor = (x,y) => x < y ? x : y;
                    const parseIntDicionario = (soMedalhistas) => mapNestedDictionary(soMedalhistas(soLondres), (key, nestedObj) => parseInt(nestedObj.Age));
                    const parseCompleto = parseIntDicionario(soMedalhistas);
                    // encontra a menor idade registrada dentre os medalhistas.s
                    const maisNovoMedalhistaAUX = (soMedalhistas) => { 
                        return Object.entries(parseIntDicionario(soMedalhistas)).reduce((acc, [key, value]) => menor(acc, value), Infinity);
                    
                    }

                    const maisNovoNome = (maisNovoMedalhistaAUX) => {
                        const atletaMaisNovo = maisNovoMedalhistaAUX(soMedalhistas);
                        // encontra a ID do atleta que possui a idade encontrada anteriormente.
                        const identidadeEIdade = (parseCompleto) => Object.entries(parseCompleto).find(([key, value]) => value === atletaMaisNovo);
                        const apenasIdentidade = identidadeEIdade(parseCompleto)[0];
                        const soMedalhistasAUX  = soMedalhistas(soLondres);
                        const resultadoAUX = (soMedalhistasAUX) => Object.entries(soMedalhistasAUX).find(([key, value]) => key === apenasIdentidade);
                        // encontra apenas os dados do atleta que possui a idade encontrada anteriormente
                        const resultado = resultadoAUX(soMedalhistasAUX)[1];
                        // encontra o nome do atleta que possui a idade encontrada anteriormente.
                        return resultado.Name;

                    }

                    const rowDiv = document.createElement('div');
                rowDiv.textContent = (`Nome : ${JSON.stringify(maisNovoNome(maisNovoMedalhistaAUX))}\nIdade: ${maisNovoMedalhistaAUX(soMedalhistas)}`);
                csvDiv.appendChild(rowDiv);
            };


    
            



            //FUNCOESDECADABOTAO:
            //Questao1
            maisNovoMedalhista(soMedalhistas)
    


          } catch (error) {
            console.error('Error:', error.message);
          }
        }
    

    async function botaoEsportesPaisMedalha() {
      try {
        const response = await fetch('/csvdata');
        if (!response.ok) {
          throw new Error('Failed to fetch CSV data');
        }
        const data = await response.json();

        // Filtra o registro para armazenar apenas os atletas que participaram da olimpíada de Londres 2012        
        const soLondres = (data) => Object.fromEntries(Object.entries(data).filter(([key, nestedObj]) => nestedObj.Year == '2012'));
        // Filtra o registro, apenas com os atletas da olimpíada de Londres 2012, que ganharam medalha        
        const soMedalhistas = (soLondres) => Object.fromEntries(Object.entries(soLondres(data)).filter(([key, nestedObj]) => nestedObj.Medal != 'NA'));
        

        const esportesPaisMedalha = (soMedalhistas) => {
            const csvDiv = document.getElementById('esportesPaisMedalhaData');
                csvDiv.innerHTML = '';
            const csvInput = document.getElementById('input1');
            const input = csvInput.value.trim();

            const eliminaRepeticoes = (registro) => { // função criada para tornar listas com elementos unicos, já que os atletas estão repetidos no .cvs de acordo com a quantidade de modalidades concorridas
            const op = (tratada, x) =>  tratada.includes(x) ? tratada : [...tratada, x];
            const semrepeticao = registro.reduce(op,[]);
            return semrepeticao;
        }

            const soPais = Object.fromEntries(Object.entries(soMedalhistas(soLondres)).filter(([key, value]) => value.Team === input || value.Team.toUpperCase() === input || value.Team.toLowerCase() === input));
            const listaesportes= Object.entries(soPais).map(([key, value]) => value.Sport); // filtra os esportes em que o determinado pais ganhou medalhas.
            const registroFormatado = eliminaRepeticoes(listaesportes);
            const resultadoFinal = registroFormatado.length != 0? registroFormatado : "Nenhum esporte :("
            console.log(resultadoFinal)
            //const exibeEsportes = registroFormatado.sort().join('\n'); // retira os elementos da lista e organiza em ordem alfabetica.
            //console.log(exibeEsportes);


            const rowDiv = document.createElement('div');
                rowDiv.textContent = (`${JSON.stringify(resultadoFinal)}`);
                csvDiv.appendChild(rowDiv);
        }
        
        esportesPaisMedalha(soMedalhistas)
        


      } catch (error) {
        console.error('Error:', error.message);
      }
    }


    async function botaoBrasilEsporteMedalhistas() {
      try {
        const response = await fetch('/csvdata');
        if (!response.ok) {
          throw new Error('Failed to fetch CSV data');
        }
        const data = await response.json();

        // Filtra o registro para armazenar apenas os atletas que participaram da olimpíada de Londres 2012        
        const soLondres = (data) => Object.fromEntries(Object.entries(data).filter(([key, nestedObj]) => nestedObj.Year == '2012'));
        // Filtra o registro, apenas com os atletas da olimpíada de Londres 2012, que ganharam medalha        
        const soMedalhistas = (soLondres) => Object.fromEntries(Object.entries(soLondres(data)).filter(([key, nestedObj]) => nestedObj.Medal != 'NA'));
        

        const brasilEsporteMedalhistas = (soMedalhistas) => {
            const csvDiv = document.getElementById('brasilEsporteMedalhistasData');
                csvDiv.innerHTML = '';
            const csvInput = document.getElementById('input2');
            const input = csvInput.value.trim();
 
            // encontra apenas os dados que incluem o esporte escolhido pelo usuario.
            const esporteEscolhido = Object.fromEntries(Object.entries(soMedalhistas(soLondres)).filter((([key, value]) => value.Sport == input|| value.Sport.toUpperCase() == input|| value.Sport.toLowerCase() == input)));
            // encontra quantas medalhas o Brasil ganhou no esporte determinado pelo usuario.
            const brasilEsporteMedalhistasAUX = (Object.entries(esporteEscolhido).filter(([key, value]) => value.Team == 'Brazil')).map((x) => 1);
            const somaDosMedalhistas = brasilEsporteMedalhistasAUX.reduce((x, y) => x + y) 
    

            const rowDiv = document.createElement('div');
                rowDiv.textContent = (`${JSON.stringify(somaDosMedalhistas)}`);
                csvDiv.appendChild(rowDiv);
        }
        
        brasilEsporteMedalhistas(soMedalhistas)
        


      } catch (error) {
        console.error('Error:', error.message);
      }
    }


    async function botaoInfoSobreAtleta() {
      try {
        const response = await fetch('/csvdata');
        if (!response.ok) {
          throw new Error('Failed to fetch CSV data');
        }
        const data = await response.json();

        // Filtra o registro para armazenar apenas os atletas que participaram da olimpíada de Londres 2012        
        const soLondres = (data) => Object.fromEntries(Object.entries(data).filter(([key, nestedObj]) => nestedObj.Year == '2012'));
        

        const infoSobreAtleta = (soLondres) => {
            const csvDiv = document.getElementById('infoSobreAtletaData');
                csvDiv.innerHTML = '';
            const csvInput = document.getElementById('input3');
            const input = csvInput.value.trim();
 
            const registroAtleta = Object.entries(soLondres(data)).filter(([key, atleta]) => atleta.Name == input || atleta.Name.toUpperCase() == input || atleta.Name.toLowerCase() == input); // armazena apenas o atleta que se deseja obter os dados.
            const soAtleta = registroAtleta[0][1]; // elimina outros possiveis registros
            const atletaSexo = soAtleta.Sex == 'M' ? 'Masculino' : 'Feminino'
            const infoFormatada = `Nome: ${soAtleta.Name}\n   Idade: ${soAtleta.Age}\n   Sexo: ${atletaSexo}\n   Altura: ${soAtleta.Height} Cm\n   Massa: ${soAtleta.Weight} Kg\n   Esporte: ${soAtleta.Sport}\n`;
    

            const rowDiv = document.createElement('div');
                rowDiv.textContent = (infoFormatada);
                csvDiv.appendChild(rowDiv);
        }
        
        infoSobreAtleta(soLondres)
        


      } catch (error) {
        console.error('Error:', error.message);
      }
    }


    async function botaoAtletaMaisMedalhas() {
      try {
        const response = await fetch('/csvdata');
        if (!response.ok) {
          throw new Error('Failed to fetch CSV data');
        }
        const data = await response.json();

        // Filtra o registro para armazenar apenas os atletas que participaram da olimpíada de Londres 2012        
        const soLondres = (data) => Object.fromEntries(Object.entries(data).filter(([key, nestedObj]) => nestedObj.Year == '2012'));
        // Filtra o registro, apenas com os atletas da olimpíada de Londres 2012, que ganharam medalha        
        const soMedalhistas = (soLondres) => Object.fromEntries(Object.entries(soLondres(data)).filter(([key, nestedObj]) => nestedObj.Medal != 'NA'));

        const atletaMaisMedalhas = (soMedalhistas) => {

            const medalhistasAgrupados = (soMedalhistas) => {
                const seRepete = (acc, curr) => {
                    acc[curr.Name] = acc[curr.Name]? [...acc[curr.Name], curr.Medal] : [curr.Medal];
                    return acc;
                };
                const completo = soMedalhistas.reduce(seRepete, {}); 
                return completo;
            };
            
            const medalhasPorAtletas = (medalhistasAgrupados) => {
                    return medalhistasAgrupados(soMedalhistas).reduce((result, [athlete, medals]) => {
                    result[athlete] = medals.reduce((acc) => acc + 1, 0);
                    return result;
                }, {});
                };
            
            const maiorQtdDeMedalhas = (medalhasPorAtletas) => {
                Object.values(medalhasPorAtletas(medalhistasAgrupados)).reduce((x, y) => {
                    return x > y ? x : y
                }, 0);
            };
            
            const resultadoFinal = (medalhasPorAtletas) => medalhasPorAtletas().filter((atleta) => atleta.medalhas == maiorQtdDeMedalhas);
            
        }
        
        atletaMaisMedalhas(soMedalhistas)
        


      } catch (error) {
        console.error('Error:', error.message);
      }
    }


        function displayCSV(data) {
          const csvDiv = document.getElementById('csvData');
          csvDiv.innerHTML = '';
          // Exercício: O método forEach é impuro, logo não é muito funcional.
          // Substitua-o por um método puro que dê no mesmo resultado.
          data.forEach(row => {
            const rowDiv = document.createElement('div');
            rowDiv.textContent = `${row.Name}, ${row.Team}, ${row.Games}`;
            csvDiv.appendChild(rowDiv);
          }
          );

        //Object.keys(data).forEach(key => {
            //const row = data[key];
            //const rowDiv = document.createElement('div');
            //rowDiv.textContent = `${row.Name}, ${row.Team}, ${row.Games}`;
            //csvDiv.appendChild(rowDiv);
        //});   

            //const x = Object.entries(data)
            
            //const rowDiv = document.createElement('div');
            //rowDiv.textContent = `${x}`;
            //csvDiv.appendChild(rowDiv);
          
        }

        

      </script>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>